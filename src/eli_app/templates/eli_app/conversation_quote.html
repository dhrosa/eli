{% load json %}
{% load markdownify %}

<article class="conversation">
  <blockquote>
    {{ object.query }}
    <footer>
      <cite>- {{ object.audience_name }} @ {{ object.timestamp }} ({{ object.timestamp|timesince}} ago)</td></cite>
    </footer>
  </blockquote>
  {% if object.ok %}
  <blockquote>
    {{ object.response_text|markdownify|linebreaks }}
    <footer>
      <cite>- ELI</cite>
    </footer>
  </blockquote>
  {% else %}
  <p>Error! Could not answer. See 'Details' below.</p>
  {% endif %}

  <dialog>
    <article>
      <header>
        <button aria-label="Close" rel="prev" onclick="closeDetails(event)"></button>
        <p>Details</p>
      </header>
      <table>
        <tbody>
          <tr><th>ID</th><td>{{ object.id }}</td></tr>
          <tr><th>Timestamp</th><td>{{ object.timestamp|date:"r" }}</td></tr>
          <tr><th>Audience Name</th><td>{{ object.audience_name }}</td></tr>
          <tr><th>System Prompt</th><td>{{ object.system_prompt|linebreaks }}</td>
          <tr><th>Query</th><td>{{ object.query }}</td></tr>
          {% if object.ok %}
          <tr><th>Response Text</th><td>{{ object.response_text|linebreaks}}</td></tr>
          {% endif %}
        </tbody>
      </table>
      <h6>Response</h6>
      {{ object.response | to_pretty_json }}      
    </article>
  </dialog>
  
  <footer>
    <div>
      <a class="material-icons" href="{{ object.get_absolute_url }}">link</a>
    </div>
    <div>
      <a class="material-icons" href="#" onclick="openDetails(event)">info</a>
    </div>
  </footer>
</article>
